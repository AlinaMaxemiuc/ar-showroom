<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AR Viewer</title>

  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    body{margin:0;font-family:system-ui;background:#0f172a;color:#fff}
    header{padding:12px 16px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select{padding:10px 12px;border-radius:12px;border:0;min-width:220px}
    a{color:#93c5fd;text-decoration:none}
    model-viewer{width:100%;height:75vh}
    .hint{opacity:.85;margin-top:6px}
  </style>
</head>

<body>
  <header>
    <div class="row">
      <strong id="title">AR Car Showroom</strong>
      <select id="carSelect"></select>
      <a href="index.html">Catalog</a>
      <a href="about.html">Despre</a>
    </div>
    <div class="hint">Alege o maÈ™inÄƒ È™i apasÄƒ butonul â€Vezi Ã®n camerÄƒ (AR)â€.</div>
  </header>

  <model-viewer id="mv"
    ar
    ar-modes="quick-look webxr scene-viewer"
    camera-controls
    auto-rotate
    environment-image="neutral"
    shadow-intensity="1"
    exposure="1.1">
    <button slot="ar-button"
      style="position:absolute;bottom:80px;left:50%;transform:translateX(-50%);
             padding:14px 22px;border-radius:30px;border:0;background:#2563eb;color:#fff;
             font-size:16px;font-weight:700;">
      ğŸ“± Vezi Ã®n camerÄƒ (AR)
    </button>
  </model-viewer>

<script>
  const mv = document.getElementById('mv');
  const title = document.getElementById('title');
  const select = document.getElementById('carSelect');

  const params = new URLSearchParams(location.search);
  const initialId = params.get('car');

  fetch('data/cars.json')
    .then(r => r.json())
    .then(cars => {
      cars.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.textContent = c.name;
        select.appendChild(opt);
      });

      function pick(id){
        return cars.find(c => c.id === id) || cars[0];
      }

      function apply(car){
        title.textContent = car.name;
        mv.setAttribute('src', car.glb);
        mv.setAttribute('ios-src', car.usdz);

        // URL shareable
        const u = new URL(location.href);
        u.searchParams.set('car', car.id);
        history.replaceState({}, '', u);
      }

      const start = pick(initialId);
      select.value = start.id;
      apply(start);

      select.addEventListener('change', () => apply(pick(select.value)));
    });
</script>
</body>
</html>
